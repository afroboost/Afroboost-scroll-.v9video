<analysis>**original_problem_statement:**
The user wants to transform the existing Afroboost application into a multi-partner SaaS platform. The application owner, Bassi (), will act as the Super Admin with complete control over the platform.

**PRODUCT REQUIREMENTS:**
1.  **Refactor & Optimize:** Clean up the monolithic  and .
2.  **Hierarchy & Access Control:** Implement a Super Admin role with full access and a Partner role with isolated data access ().
3.  **SaaS Monetization & White-Labeling:**
    *   Partners must purchase credit packs. Partner actions consume credits.
    *   Implement Stripe Connect for direct partner payouts.
    *   The partner's public page () must be a visual mirror of , with full visual customization.
4.  **UI/UX & Features (Missions):**
    *   **v9.4.7:** Implement a dynamic video carousel of partners on the homepage and streamline the Become Partner login flow.
    *   **v9.4.8:** Convert the homepage carousel to a Reels-style vertical snap-scroll feed with a minimalist overlay UI.
    *   **v9.4.9:** Further refine the Reels UI (remove clutter), add a Retour au Flux button on the partner vitrine that preserves scroll position, and add robust video link compatibility (YouTube/MP4) with a fallback.
    *   **v9.5.0:** Add a video link uploader and credit balance display in the partner dashboard.
    *   **v9.5.1:** Redesign the Reels feed header (logo, search icon), implement single/double-click video interactions, and fix the color customization feature in the dashboard.
    *   **v9.5.2:** Implement intelligent routing post-login (redirecting active partners to their dashboard) and optimize the video feed with lazy loading.
    *   **v9.5.3:** Replace a broken default video URL and implement the search functionality in the Reels feed.
    *   **v9.5.4:** Make the Reels feed a full-screen experience by removing extra UI elements and finalize the partner redirection logic.

**User's preferred language**: français

**what currently exists?**
The application's homepage has been transformed into a full-screen, Reels-style vertical video feed. This feed, which is now the central user experience, lazy-loads and displays videos from active partners. The UI is highly minimalist, with a small logo and search icon in the header, and an overlay on the video showing partner info (profile picture, name, bio), a Like button, and a compact Réserver button.

Key functionalities implemented:
-   **Intelligent Routing:** After login, active partners are automatically redirected to their dashboard, while non-partners receive a toast notification and remain on the Become Partner page.
-   **Seamless Navigation:** Users can double-click a video to navigate to the partner's  (public page). The  now features a Retour au Flux button that returns the user to their exact position in the video feed.
-   **Partner Autonomy:** Partners can update their profile video link (YouTube or direct MP4) and view their credit balance from their dashboard.
-   **Search:** Users can filter the video feed by partner name using a search bar activated by a loupe icon.
-   **UI/UX:** The interface is mobile-first, full-screen, and customizable with partner-specific colors.

**Last working item**:
    - Last item agent was working: **Mission v9.5.4: Nettoyage Case et Réparation Bouton**. The agent worked on making the Reels-style video feed a true full-screen experience by removing extraneous UI elements (like a duplicate search bar and extra margins) and finalized the redirection logic that sends paying partners directly to their dashboard after login.
    - Status: USER VERIFICATION PENDING
    - Agent Testing Done: Y
    - Which testing method agent to use? NA
    - User Testing Done: N

**All Pending/In progress Issue list**:
  - Issue 1:  (P1) Implement Stripe Connect for partner coaches.
  
  Issues Detail:
  - Issue 1: 
     - **Description**: This is a major pending feature from the original product requirements. Partners need the ability to connect their own Stripe accounts to receive payments for their services directly. The UI tab exists, but the full onboarding and payment processing flow is not implemented.
     - **Attempted fixes**: None.
     - **Next debug checklist**:
       - Connect the frontend Connecter mon Stripe button in  to a new backend onboarding API.
       - Use the  agent to get the correct Stripe Connect implementation plan.
       - Create a backend API using the Stripe SDK to initiate a Stripe Connect onboarding session ().
       - Implement the redirect flow to and from Stripe's onboarding page.
       - Modify the Stripe webhook handler in  to correctly route events from connected accounts.
     - **Why fix this issue and what will be achieved with the fix?**: This enables the platform to function as a true marketplace where partners can manage their own revenue, completing a core aspect of the SaaS model.
     - **Status**:  NOT STARTED
     - **Is recurring issue?** N
     - **Should Test frontend/backend/both after fix?** Both
     - **Blocked on other issue**: None

**In progress Task List**:
  - Task 1:  (P1) Continue modularizing .
  - Task 2:  (P1) Continue modularizing .

 Task Detail:
  - Task 1: 
     - **Where to resume**:  is still a large monolith. The next logical step is to extract route groups (e.g., Stripe, AI, Campaigns) into their own files under .
     - **What will be achieved with this?**: Improving code organization, maintainability, and stability.
     - **Status**:  IN PROGRESS
     - **Should Test frontend/backend/both after fix?** Backend
     - **Blocked on something**: None
  - Task 2: 
     - **Where to resume**:  remains extremely large. The next step is to extract other major sections like Réservations or Offres into their own components within .
     - **What will be achieved with this?**: Reducing the complexity of the main dashboard component, making it easier and safer to modify.
     - **Status**:  IN PROGRESS
     - **Should Test frontend/backend/both after fix?** Frontend
     - **Blocked on something**: None

**Upcoming and Future Tasks**
    Upcoming Tasks:
    - **(P0)** Implement Stripe Connect (see Issue #1 above).
    - **(P1)** Implement the partner credit system: create endpoints and UI for purchasing credit packs and logic for consuming credits when performing actions.
    - **(P2)** Finalize the partner dashboard UI to clearly display the current credit balance and provide an alert/link to buy more when the balance is zero.
    
    Future Tasks:
    - Continue progressive refactoring of  and .

**Completed work in this session**
- **v9.5.4:** Made the Reels feed full-screen and fixed the partner redirection logic.
- **v9.5.3:** Replaced the broken default video and implemented search functionality in the Reels feed.
- **v9.5.2:** Implemented intelligent routing post-login and optimized the video feed with lazy loading.
- **v9.5.1:** Redesigned the Reels feed header (logo, search icon), added single/double-click interactions, and added a manual save button for color settings.
- **v9.5.0:** Added a video link uploader and credit balance display in the partner dashboard.
- **v9.4.9:** Refined the Reels UI, added robust video fallback, and created a Retour au Flux button on the partner vitrine.
- **v9.4.8:** Converted the homepage from a horizontal carousel to a vertical Reels-style snap-scroll feed.
- **v9.4.7:** Implemented a dynamic video carousel on the homepage and improved the Become Partner flow.

**Earlier issues found/mentioned but not fixed**
   - **Issue 1**: The color customization in the partner dashboard was reported as not working. A manual save button was added as a fix (Mission v9.5.1), but the root cause of the auto-save failing might persist. The  hook or state propagation could be investigated if the issue reappears.

**Known issue recurrence from previous fork**
  - None.

**Code Architecture**


**Key Technical Concepts**
- **Reels-Style Vertical Snap Scroll:** Using  and  for a smooth, TikTok-like scrolling experience.
- **Full-Screen UI:** Using  to make the Reels component take over the viewport, hiding other page elements.
- **Conditional Routing & UI:** Using state (, ) fetched from the backend to dynamically render UI and control navigation post-login.
- **Lazy Loading with :** Implemented via a custom hook to only load videos when they are visible in the viewport, improving performance.
- **Client-Side Search:** Filtering the list of partners directly in the frontend based on user input.
- **Navigation State Preservation:** Using  to save the scroll position of the Reels feed, allowing the Retour au Flux button to restore the user's exact location.

**key DB schema**
- **coaches**: 
- **concept**: 

**changes in tech stack**
- No changes.

**All files of reference**
- **Heavily Modified:**
  - : Rewritten multiple times to evolve from a horizontal carousel to a full-screen, minimalist, searchable vertical Reels feed.
  - : Layout logic was significantly altered to conditionally render the full-screen Reels feed or the standard page content.
  - : Created and modified to handle video rendering, overlays (profile, bio, like), and click/double-click events.
  - : Added  to serve videos for the feed and  for the intelligent routing logic.
  - : Updated to allow partners to edit their video URL and to display their credit balance.
  - : Updated to handle the new redirection logic and toast notifications.
  - : Modified to include the Retour au Flux button.

**Areas that need refactoring**:
- ****: **CRITICAL**. Still a large monolith.
- ****: **CRITICAL**. Extremely large and complex, making it difficult to maintain.

**key api endpoints**
- : Fetches all active partners with their concept data (video URL, colors, etc.) for the Reels feed.
- : Checks if a logged-in user has an active partner subscription. Returns .
- : (Authenticated) Updates a partner's visual concept, including .

**Critical Info for New Agent**
- **Reels is the Core UX:** The application's primary interface is now the full-screen vertical video feed. All changes should be mindful of this mobile-first, minimalist design.
- **Verify Login Logic:** The redirection logic after login is crucial. Test with a super admin, a paying partner, and a new user to ensure all cases work as expected.
- **Stripe Connect is the Next Big Task:** This is the most significant pending feature from the original spec. Use the  agent to ensure a correct and secure implementation.
- **Monoliths are Risky:** Be cautious when editing  and . They are sources of technical debt. Prioritize extracting logic from them when possible.

**documents and test reports created in this job**
- Continuously updated .
- Test reports generated for each mission up to  via .

**Last 10 User Messages and any pending HUMAN messages**
- **v9.5.4 (Completed):** Remove an extra UI element (case) and fix the partner redirection logic.
- **v9.5.3 (Completed):** Replace the broken default video URL and implement search functionality in the feed.
- **v9.5.2 (Completed):** Implement intelligent login routing and optimize the video feed with lazy loading.
- **v9.5.1 (Completed):** Add a logo and search icon to the feed header and implement single/double-click interactions.
- **v9.5.0 (Completed):** Add video uploader and credit balance display to the partner dashboard.
- **v9.4.9 (Completed):** Refine the Reels UI, add a robust video fallback, and create a Retour au Flux button.
- **v9.4.8 (Completed):** Convert the homepage to a vertical Reels-style scroll feed.
- **v9.4.7 (Completed):** Implement a dynamic partner video carousel on the homepage.
- **v9.4.6 (Handled previously):** Clean up the hero video and add a PWA Install button.
- **v9.4.5 (Handled previously):** Cleaned up the partner page header and simplified the booking form.

**Project Health Check:**
- **Brittle:** While functionally advanced, the application's reliance on two large monolithic files (, ) remains a significant architectural risk. The feature velocity is high, but the technical debt is accumulating.

**3rd Party Integrations**
- **Stripe:** Used for payment processing. Stripe Connect is the next major integration task.
- **Resend:** Used for transactional and campaign emails.
- **Google Auth:** Used for user login.

**Testing status**
  - Testing agent used after significant changes: YES
  - Troubleshoot agent used after agent stuck in loop: NO
  - Test files created: No new files, but existing tests were run.
  - Known regressions: None.

**Credentials to test flow:**
- **Super Admin Email:** 
- **Partner Test Account:** Use any new Google account. The system will auto-create a profile. Use the 0 CHF test pack to onboard a new partner for free to test the non-paying flow, then simulate payment (e.g., by manually setting credits in the DB) to test the active partner flow.
- **Access Method:** Login with Google. For Super Admin, triple-click the © Afroboost 2026 footer text to open the login modal.

**What agent forgot to execute**
The agent has been thorough in completing the user's mission requests sequentially. No immediate actions were forgotten. The primary forgotten items are long-term strategic tasks like implementing Stripe Connect and refactoring the monoliths, which are captured as pending tasks.</analysis>
