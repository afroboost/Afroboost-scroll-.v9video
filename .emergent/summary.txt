<analysis>**original_problem_statement:**
The user wants to transform the existing Afroboost application into a multi-coach SaaS platform. The application owner, Bassi (), will act as the Super Admin with complete control over coach subscription packs and access to all data.

**PRODUCT REQUIREMENTS:**
1.  **Refactor & Optimize:** Clean up the codebase by removing the legacy Articles and Medias modules to reduce the line count of  below a target of 7200 lines, while staying under a hard limit of 7450 lines.
2.  **Hierarchy & Access Control:**
    *   **Super Admin:** Bassi has exclusive access to a Super Admin panel for managing the platform.
    *   **Partner Coaches:** Can sign up, purchase credit packs, and access an isolated dashboard to manage their own clients, courses, and campaigns.
    *   **Data Isolation:** All data (contacts, reservations, campaigns, etc.) must be strictly segregated per coach using a . Bassi, as Super Admin, must have visibility over all data on the platform.
3.  **SaaS Monetization:**
    *   The Super Admin must be able to create, update, and delete Coach Packs (defining price and number of credits) directly from the UI, with changes automatically syncing to Stripe.
    *   Coach actions, such as sending campaigns or using the CRM, must consume credits from their balance.
4.  **UI/UX & Features:**
    *   Implement a Devenir Coach (Become a Coach) page and signup flow.
    *   Add a homepage feature to search for coaches.
    *   Create a public-facing vitrine (storefront) page for each coach at a unique URL ().
5.  **Non-Regression Clause:** All existing functionality for Bassi's core fitness business (client payments, course bookings, QR codes) must remain 100% intact and unaffected by the new SaaS features.

**User's preferred language**: français

**what currently exists?**
The application has been successfully transformed into a foundational multi-coach SaaS platform. The legacy Articles and Medias modules have been removed, bringing the  file down to ~7340 lines (from 7450).

A Super Admin role and a dedicated panel have been implemented for Bassi, allowing management of coach subscription packs with automatic Stripe integration. A full signup flow for new coaches exists via a Devenir Coach page.

The core multi-tenant architecture is in place: key database collections now use a  for data isolation, and API endpoints have been secured to enforce this separation. A critical rule allows the Super Admin to bypass all filters, ensuring full data visibility. A public storefront for coaches () has also been created.

**Last working item**:
    - Last item agent was working: The agent was executing **Mission v8.9.7**. The primary goal was to ensure the data integrity of the new multi-tenant system. This involved creating a one-time data migration script to assign  to all of Bassi's pre-existing data (contacts, reservations, etc.), guaranteeing he would not lose access to any historical records after the data isolation filters were activated.
    - Status: IN PROGRESS
    - Agent Testing Done: Y
    - Which testing method agent to use? backend testing agent
    - User Testing Done: N

**All Pending/In progress Issue list**:
  - Issue 1: Run the  data migration script. (P0)
  - Issue 2: Implement the credit consumption system for coaches. (P1)
  - Issue 3: Implement Stripe Connect for partner coaches. (P2)
  
  Issues Detail:
  - Issue 1: 
     - **Description**: An endpoint () was created to tag all legacy documents with . This is a critical one-time task to ensure Bassi retains access to all his historical data. The endpoint has been created but has not yet been executed.
     - **Next debug checklist**:
       - Use  to call the  endpoint.
       - Verify via API calls that Bassi's dashboard continues to show all his historical data (e.g., his 7 existing reservations).
     - **Why fix this issue and what will be achieved with the fix?**: This finalizes the data isolation architecture, safeguarding all of the original user's data and preventing it from becoming inaccessible under the new multi-coach filtering rules.
     - **Status**:  NOT STARTED
     - **Is recurring issue?** N
     - **Should Test frontend/backend/both after fix?** Both
     - **Blocked on other issue**: None
  - Issue 2: 
     - **Description**: The platform needs to deduct credits from a coach's balance when they use features like the CRM or send marketing campaigns. The data models support credits, but the backend logic to decrement them is missing.
     - **Next debug checklist**:
       - Identify all API endpoints that should consume credits.
       - Add logic to these endpoints to check a coach's credit balance, return an error if it's zero, and decrement the balance upon successful use.
       - Ensure the Super Admin (Bassi) is exempt from all credit deductions.
     - **Why fix this issue and what will be achieved with the fix?**: This implements the core monetization logic of the SaaS model.
     - **Status**:  NOT STARTED
     - **Is recurring issue?** N
     - **Should Test frontend/backend/both after fix?** Both
     - **Blocked on other issue**: None
  - Issue 3: 
     - **Description**: Partner coaches need the ability to connect their own Stripe accounts to receive payments for their services. The basic backend endpoints and a UI tab exist, but the full onboarding and payment processing flow is not implemented.
     - **Next debug checklist**:
       - Connect the frontend Connecter mon Stripe button to the backend onboarding API.
       - Handle the redirect flow to and from Stripe's onboarding page.
       - Modify the Stripe webhook to correctly handle events from connected accounts.
     - **Why fix this issue and what will be achieved with the fix?**: This enables the platform to function as a true marketplace where coaches can manage their own revenue.
     - **Status**:  NOT STARTED
     - **Is recurring issue?** N
     - **Should Test frontend/backend/both after fix?** Both
     - **Blocked on other issue**: None

**In progress Task List**:
  There are no multi-step tasks currently in progress. The work is focused on the pending issues listed above.

**Upcoming and Future Tasks**
    Upcoming Tasks:
    - **(P1)** Finalize the coach dashboard UI to clearly display the current credit balance.
    - **(P2)** Implement frontend logic to disable UI features (e.g., Send Campaign button) when a coach's credit balance is zero.
    
    Future Tasks:
    - **(CRITICAL)** Decompose the monolithic  file into a modular structure (e.g., routers, services, models) to overcome the 7450-line limit and improve maintainability.
    - Refactor large frontend components like  and  into smaller, more manageable sub-components.

**Completed work in this session**
- **Code Refactoring:** Successfully removed Articles and Medias modules from both backend and frontend, reducing  from 7450 to ~7340 lines.
- **SaaS Architecture:** Implemented Super Admin role, a management panel for Coach Packs with automatic Stripe integration, and a complete signup flow for new coaches.
- **Multi-Tenant Data Isolation:** Secured key API endpoints with  filtering, while ensuring the Super Admin retains universal data access. Created a migration script for legacy data.
- **Frontend Features:** Created a Devenir Coach page, a coach search modal, and a public vitrine (storefront) for each coach. Fixed all requested UI/UX issues, including button placement and icon alignment.

**Code Architecture**


**Key Technical Concepts**
- **Backend:** FastAPI (Python)
- **Frontend:** React.js
- **Database:** MongoDB
- **Architecture:** Monolithic backend () being transitioned to a multi-tenant SaaS model.
- **Data Isolation:** Uses a  field in MongoDB collections and a custom  HTTP header to filter data per coach at the API level.
- **Payments:** Stripe for platform and coach payments. Stripe Connect is planned for coach payouts.
- **Critical Constraint:** A hard limit of 7450 lines in  dictates a strong focus on code optimization.

**key DB schema**
- **coaches**: 
- **coach_packs**: 
- **chat_participants (contacts)**: 
- **reservations**: 
- **campaigns**: 

**All files of reference**
- : The monolithic backend file. Heavily modified to add the entire SaaS architecture. Currently at ~7340 lines.
- : Main frontend component, handles routing and state for the new pages and roles.
- : Dashboard UI, modified to add coach-specific features like the Mon Stripe tab.
- : **New file**. UI for the Super Admin to manage coach packs.
- : **New file**. Signup page for new coaches.
- : **New file**. Modal UI for the coach search feature.
- : **New file**. Public storefront page for individual coaches.

**Areas that need refactoring**:
- ****: **CRITICAL**. The file is dangerously close to its hard limit of 7450 lines. It must be broken down into a modular structure (routers, services, etc.) before significant new features can be added.
- ****: This component remains excessively large (over 6000 lines) and should be decomposed into smaller, reusable components.

**key api endpoints**
- : (Super Admin) Create a new coach pack.
- : (Super Admin) Update a coach pack.
- : (Super Admin) One-time endpoint to assign  to legacy documents.
- : Creates Stripe checkout for a coach buying a pack.
- : Fetches public data for a coach's storefront page.
- : Fetches reservations, filtered by .

**Critical Info for New Agent**
- ** LINE LIMIT:** You are working with a buffer of only ~110 lines. Prioritize optimization and code reduction. Do not add new features without a plan to stay under the 7450-line limit. Refactoring is the only sustainable path forward.
- **NON-REGRESSION IS PARAMOUNT:** The original fitness coaching business (course bookings, payments for clients, QR codes) must remain 100% functional. All new SaaS logic is built around the existing, working system.
- **DATA MIGRATION PENDING:** The migration script to assign  to all legacy data has been created but **not yet run**. This is the highest priority next step to ensure data integrity.

**documents and test reports created in this job**
-  (Updated)

**Last 10 User Messages and any pending HUMAN messages**
- The user has provided a series of iterative requests (v8.9 to v8.9.7) to build out the SaaS platform, focusing on UX tweaks, data isolation, and ensuring zero regression on existing features. The last request was to clean up , create the data migration script, and verify all tunnels and storefronts were operational.

**Project Health Check:**
- **Functional:** Yes.
- **Brittle:** EXTREMELY. The monolithic nature and size of  is a critical risk to future development and stability.

**3rd Party Integrations**
- **Stripe:** Payment processing.
- **Resend:** Transactional emails.
- **api.qrserver.com:** QR code generation.

**Testing status**
- **Testing agent used after significant changes:** YES
- **Test files created:** None
- **Known regressions:** None

**Credentials to test flow:**
- **Super Admin Email:** 
- **Access Method:** Login with Google, then triple-click the © Afroboost 2026 text in the website footer to open the login modal.</analysis>
